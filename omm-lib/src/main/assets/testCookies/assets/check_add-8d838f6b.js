import{m as T}from"./moment-53e63b5e.js";import{d as E,a as F,u as I,J as M,r as h,ay as R,f as i,o as Y,g as B,h as s,z as o,W as n,a0 as v,j as H,Z as N,a1 as P,a2 as S,H as b,Q as A,aE as J,az as L,aF as Q}from"./index-24b7b5a4.js";import{d as W}from"./useCheck-76650f95.js";const Z={style:{margin:"16px"}},ee=E({__name:"check_add",setup($){const g=F(),x=I(),m=M(),{fromData:a,run:_}=W();a.value.bianhao=g.query.bh,a.value.faqibumenjgdm=m.userInfo.depcode,a.value.faqibumen=m.userInfo.depname,a.value.faqiren=m.userInfo.name,a.value.faqirensfz=m.userInfo.idcard;const r=h(),f=h([]);h(!1);const w=[{text:"情指",value:"00"},{text:"国保",value:"01"},{text:"治安",value:"03"},{text:"刑侦",value:"05"},{text:"网安",value:"11"},{text:"jz",value:"12"},{text:"监管",value:"13"},{text:"交警",value:"17"},{text:"其他",value:"99"}],y=[{text:"核查",value:"核查"},{text:"防范",value:"防范"},{text:"预警",value:"预警"},{text:"关注",value:"关注"}],q=[{text:"一般",value:"一般"},{text:"重要",value:"重要"},{text:"紧急",value:"紧急"}],p=h(!1);R(()=>{p.value?L({message:"提交中...",forbidClick:!0,duration:0}):Q()});const z=d=>{const e=new FormData;e.append("file",d.file),P("/gather/upload",e).then(u=>{S({bianhao:g.query.bh,wenjian:d.file.name,path:u}).then(t=>{t&&b("附件上传成功")})})};function j(){a.value.xiafashijian=T().format("YYYY-MM-DD HH:mm:ss");const d=[],e=[];r.value&&r.value&&d.push({...a.value,shifouzhuban:"主办",hechabumen:r.value.text,hechabumdm:r.value.value});const u=f.value.filter(t=>t.value);u.length>0&&u.forEach(t=>{d.push({...a.value,shifouzhuban:"协办",hechabumen:t.text,hechabumdm:t.value})}),console.log("xb",u),d.forEach(t=>{e.push(_(t))}),p.value=!0,Promise.all(e).then(t=>{A({message:"是否需要盯办？"}).then(()=>{J({db:"是",bianhao:a.value.bianhao}).then(c=>{console.log("返回列表",c),c===1?(b("该条信息已被盯办成功"),x.back()):b("盯办失败，请重新尝试")})}).catch(()=>{x.back()})}).catch(t=>{console.error("提交失败",t)}).finally(()=>{p.value=!1})}return(d,e)=>{const u=i("van-field"),t=i("van-cell-group"),c=i("DateTimePicker"),U=i("OrgCascader"),k=i("OrgCascaderMultiple"),C=i("van-uploader"),V=i("van-switch"),D=i("van-button"),O=i("van-form");return Y(),B(O,{onSubmit:j},{default:s(()=>[o(t,{inset:"",style:{"margin-top":"20px"}},{default:s(()=>[o(u,{modelValue:n(a).hechayaoqiu,"onUpdate:modelValue":e[0]||(e[0]=l=>n(a).hechayaoqiu=l),"label-align":"top",rows:"5",autosize:"",label:"核查要求",type:"textarea",required:"",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(t,{inset:"",style:{"margin-top":"20px"}},{default:s(()=>[o(c,{modelValue:n(a).hechashixian,"onUpdate:modelValue":e[1]||(e[1]=l=>n(a).hechashixian=l),required:"",label:"核查时限",placeholder:"请点击选择"},null,8,["modelValue"]),o(v,{modelValue:n(a).yewujingzhong,"onUpdate:modelValue":e[2]||(e[2]=l=>n(a).yewujingzhong=l),options:w,required:"",label:"业务警种",placeholder:"请点击选择"},null,8,["modelValue"]),o(U,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=l=>r.value=l),"is-link":"",required:"",label:"主办单位",placeholder:"请点击选择"},null,8,["modelValue"])]),_:1}),o(t,{inset:"",title:"核查单位"},{default:s(()=>[o(k,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),required:"",label:"核查单位",placeholder:"请点击选择"},null,8,["modelValue"])]),_:1}),o(t,{inset:"",title:"附件上传"},{default:s(()=>[o(u,{name:"uploader","label-align":"top"},{input:s(()=>[o(C,{modelValue:n(a).file,"onUpdate:modelValue":e[5]||(e[5]=l=>n(a).file=l),"after-read":z},null,8,["modelValue"])]),_:1})]),_:1}),o(t,{inset:"",style:{"margin-top":"20px"}},{default:s(()=>[o(u,{name:"switch",label:"是否归档",required:""},{"right-icon":s(()=>[o(V,{modelValue:n(a).shifouguidang,"onUpdate:modelValue":e[6]||(e[6]=l=>n(a).shifouguidang=l)},null,8,["modelValue"])]),_:1}),o(u,{name:"switch",label:"是否采用",required:""},{"right-icon":s(()=>[o(V,{modelValue:n(a).shifoucaiyong,"onUpdate:modelValue":e[7]||(e[7]=l=>n(a).shifoucaiyong=l)},null,8,["modelValue"])]),_:1}),o(v,{modelValue:n(a).chizhileix,"onUpdate:modelValue":e[8]||(e[8]=l=>n(a).chizhileix=l),options:y,required:"",label:"处置类型",placeholder:"请点击选择"},null,8,["modelValue"]),o(v,{modelValue:n(a).hechazhuangtai,"onUpdate:modelValue":e[9]||(e[9]=l=>n(a).hechazhuangtai=l),options:q,required:"",label:"紧急状态",placeholder:"请点击选择"},null,8,["modelValue"])]),_:1}),H("div",Z,[o(D,{block:"",type:"primary","native-type":"submit",loading:p.value},{default:s(()=>[N(" 提交 ")]),_:1},8,["loading"])])]),_:1})}}});export{ee as default};
