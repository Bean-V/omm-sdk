import{m as h}from"./moment-53e63b5e.js";import{d as F,a as O,u as H,J as I,r as c,$ as S,f as s,o as E,l as T,z as o,h as i,W as t,a0 as g,j as A,Z as B,Q as N,a1 as P,a2 as R,_ as $}from"./index-24b7b5a4.js";import{u as J}from"./useCheck-4fb33ac8.js";const Q={style:{padding:"5px 16px",display:"flex","justify-content":"space-around"}},W=F({__name:"directive_add",setup(X){O(),H();const p=I(),{loading:f,addDirective:x,addDirectiveHC:b,fromData:a}=J();a.value.xsbh=h().format("YYYYMMDDHHmmss")+Math.floor(1e3+Math.random()*9999),a.value.xiafabum=p.userInfo.depname,a.value.xifajgdm=p.userInfo.depcode,a.value.xiafaren=p.userInfo.name,a.value.xiafarensfz=p.userInfo.idcard;const r=c(),v=c([]);c(!1);const V=[{text:"情指",value:"00"},{text:"国保",value:"01"},{text:"治安",value:"03"},{text:"刑侦",value:"05"}],w=[{text:"一般",value:"一般"},{text:"加急",value:"加急"},{text:"紧急",value:"紧急"},{text:"特急",value:"特急"}],_=c({});S({leibie:"cjleibie"}).then(d=>{const e=d[0].map((u,l)=>(u={text:u,value:u},u));_.value=e});function y(){N({title:"提示",message:"是否下发该条指令?"}).then(()=>{a.value.wanchengshixian=h().format("YYYY-MM-DD HH:mm:ss");debugger;const d=[],e=[];r.value&&r.value&&d.push({...a.value,shifouzhuban:"主办",hechadanw:r.value.text,hechadanweidm:r.value.value});const u=v.value.filter(l=>l.value);u.length>0&&u.forEach(l=>{d.push({...a.value,shifouzhuban:"协办",hechadanw:l.text,hechadanweidm:l.value})}),console.log("xb",u),console.log("d",d),e.push(x()),d.forEach(l=>{e.push(b(l))}),console.log("p",e),f.value=!0,Promise.all(e).then(l=>{console.log("E",l)}).catch(l=>{console.error("提交失败",l)}).finally(()=>{f.value=!1})}).catch(()=>{})}function j(){}const z=d=>{const e=new FormData;e.append("file",d.file),P("/gather/upload",e).then(u=>{R({bianhao:a.value.xsbh,wenjian:d.file.name,path:u}).then(l=>{l&&showSuccessToast("附件上传成功")})})};return(d,e)=>{const u=s("FieldAndSelect"),l=s("van-field"),m=s("van-cell-group"),D=s("DateTimePicker"),C=s("OrgCascader"),k=s("OrgCascaderMultiple"),q=s("van-uploader"),U=s("van-button"),M=s("van-form"),Y=s("van-skeleton");return E(),T("div",null,[o(Y,{loading:t(f),animate:!1},{default:i(()=>[o(M,{onSubmit:j},{default:i(()=>[o(m,{inset:"",style:{"margin-top":"20px"}},{default:i(()=>[o(u,{modelValue:t(a).biaoti,"onUpdate:modelValue":e[0]||(e[0]=n=>t(a).biaoti=n),label:"标题",placeholder:"请输入内容",required:"",options:_.value,loading:!1},null,8,["modelValue","options"]),o(l,{modelValue:t(a).zhilingyaoq,"onUpdate:modelValue":e[1]||(e[1]=n=>t(a).zhilingyaoq=n),"label-align":"top",rows:"5",autosize:"",label:"核查要求",type:"textarea",maxlength:"500",required:"",placeholder:"请输入内容","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(m,{inset:"",style:{"margin-top":"20px"}},{default:i(()=>[o(D,{modelValue:t(a).wanchengshixian,"onUpdate:modelValue":e[2]||(e[2]=n=>t(a).wanchengshixian=n),required:"",label:"核查时限",placeholder:"请点击选择"},null,8,["modelValue"]),o(g,{modelValue:t(a).jingjizhuangtai,"onUpdate:modelValue":e[3]||(e[3]=n=>t(a).jingjizhuangtai=n),options:w,required:"",label:"紧急状态",placeholder:"请点击选择"},null,8,["modelValue"]),o(g,{modelValue:t(a).ywjzdm,"onUpdate:modelValue":e[4]||(e[4]=n=>t(a).ywjzdm=n),options:V,required:"",label:"业务警种",placeholder:"请点击选择"},null,8,["modelValue"]),o(C,{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=n=>r.value=n),"is-link":"",required:"",label:"主办单位",placeholder:"请点击选择"},null,8,["modelValue"])]),_:1}),o(m,{inset:"",title:"协办单位"},{default:i(()=>[o(k,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=n=>v.value=n),required:"",label:"协办单位",placeholder:"请点击选择"},null,8,["modelValue"])]),_:1}),o(m,{inset:"",title:"附件上传"},{default:i(()=>[o(l,{name:"uploader","label-align":"top"},{input:i(()=>[o(q,{modelValue:t(a).file,"onUpdate:modelValue":e[7]||(e[7]=n=>t(a).file=n),"after-read":z},null,8,["modelValue"])]),_:1})]),_:1}),A("div",Q,[o(U,{type:"primary",block:"",onClick:y},{default:i(()=>[B(" 指令发送 ")]),_:1})])]),_:1})]),_:1},8,["loading"])])}}});const L=$(W,[["__scopeId","data-v-b8f158fb"]]);export{L as default};
