import{d as E,a as F,r as H,Y as P,f as s,o as l,l as d,z as e,h as t,j as p,F as B,D as N,W as z,g,n as f,t as b,Z as h,aG as W,_ as J,u as G,J as K,C as Q,ae as X,aJ as ee,Q as A,aL as ae,H as U,aM as ne,aN as te,P as oe,aO as le,aP as se,a3 as ue}from"./index-24b7b5a4.js";import{c as ie}from"./useFeedback-d8e89425.js";import{l as re}from"./lql-empty-4651ebc0.js";import{m as I}from"./moment-53e63b5e.js";import{f as ce}from"./custom-f463eef0.js";const de={class:"page"},_e={style:{flex:"1","margin-top":"30px"}},pe={style:{"margin-bottom":"26px",background:"#fff",padding:"15px","border-radius":"4px"}},he={key:0,class:"error-message"},me={key:1},ve={class:"custom-title"},fe={key:0,class:"space-between"},ge={key:1,class:"space-between"},be={class:"space-between"},xe=E({__name:"reslove_list",setup(O){const w=F().query.xsbh,{loading:x,run:V,data:m,error:a}=ie();V(w||""),console.log("data",w,m.value);const v=async()=>{V(w||"")},Y=H(!0);return P(()=>x.value,j=>{j||(Y.value=!1)},{immediate:!0}),(j,q)=>{const _=s("van-skeleton-paragraph"),y=s("van-tag"),k=s("van-cell"),u=s("van-text-ellipsis"),n=s("van-space"),i=s("van-cell-group"),c=s("van-skeleton"),C=s("van-pull-refresh"),D=s("van-back-top");return l(),d("div",de,[e(C,{modelValue:z(x),"onUpdate:modelValue":q[0]||(q[0]=o=>W(x)?x.value=o:null),onRefresh:v,"success-text":"加载成功","loading-text":"加载中..."},{default:t(()=>[e(c,{loading:Y.value,animate:!1},{template:t(()=>[p("div",_e,[p("div",pe,[e(_,{"row-width":"60%"}),e(_),e(_),e(_)]),(l(),d(B,null,N(3,o=>p("div",{key:o,style:{"margin-bottom":"20px",background:"#fff",padding:"15px","border-radius":"4px"}},[e(_),e(_),e(_)])),64))])]),default:t(()=>[z(a)?(l(),d("div",he,"加载失败，请重试")):(l(),d("div",me,[z(m).length===0?(l(),g(re,{key:0})):f("",!0),(l(!0),d(B,null,N(z(m),(o,R)=>(l(),g(i,{key:R,inset:"",class:"m-tb15"},{default:t(()=>[e(k,null,{title:t(()=>[p("span",ve,b(o.hechadanw),1),e(y,{mark:"",type:o.shifouzhuban=="主办"?"danger":"primary"},{default:t(()=>[h(b(o.shifouzhuban),1)]),_:2},1032,["type"])]),_:2},1024),e(k,null,{default:t(()=>[e(u,{rows:"3",content:o.hechaneirong||"暂无反馈信息","expand-text":"展开","collapse-text":"收起"},null,8,["content"])]),_:2},1024),o.qianshouren||o.hecharen?(l(),g(k,{key:0},{default:t(()=>[o.qianshouren?(l(),d("div",fe,[p("span",null,[e(y,{plain:"",type:"success"},{default:t(()=>[h("签收 ")]),_:1}),h(" "+b(o.qianshouren),1)]),p("span",null,b(o.qianshoushijian),1)])):f("",!0),o.hecharen?(l(),d("div",ge,[p("span",null,[e(y,{plain:"",type:"primary"},{default:t(()=>[h("反馈 ")]),_:1}),h(" "+b(o.hecharen),1)]),p("span",null,b(o.fankuishijian),1)])):f("",!0)]),_:2},1024)):f("",!0),o.qianshouren&&o.hecharen?f("",!0):(l(),g(k,{key:1},{default:t(()=>[p("div",be,[e(n,null,{default:t(()=>[o.qianshouren?f("",!0):(l(),g(y,{key:0,size:"medium",color:"#ebedf0","text-color":"#666"},{default:t(()=>[h("待签收")]),_:1})),o.hecharen?f("",!0):(l(),g(y,{key:1,size:"medium",color:"#ebedf0","text-color":"#666"},{default:t(()=>[h("待反馈")]),_:1}))]),_:2},1024)])]),_:2},1024))]),_:2},1024))),128))]))]),_:1},8,["loading"])]),_:1},8,["modelValue"]),e(D)])}}});const ye=J(xe,[["__scopeId","data-v-065ec559"]]),ke={class:"page"},ze={key:0,class:"stamp"},we=E({__name:"directive_feedback",setup(O){const M=H(0),w=F(),x=G(),V=K(),m=w.query.xsbh,a=H({}),v=H([]),Y=H([]);Q(()=>{j()});const j=()=>{X({condition:"xsbh="+m,num:10,start:0}).then(u=>{let n=u.rows[0];u.rows.length>0&&Array.isArray(u.rows)&&(n.ywjzdm=n.ywjzdm,n.hechashixian=I(n.hechashixian).format("YYYY-MM-DD HH:mm:ss"),n.xiafashijian=I(n.xiafashijian).format("YYYY-MM-DD HH:mm:ss"),a.value=n),ee(m).then(i=>{Y.value=i,i.length>0&&Array.isArray(i)&&i.filter(c=>{c.shifouzhuban=="主办"?a.value.zhuban=c.hechadanw:c.shifouzhuban=="协办"&&v.value.push(c.hechadanw),console.log("fromData.value:",a.value)})})})},q=()=>{A({message:`是否确认撤回该指令?
提示：仅限制下发部门撤回`}).then(()=>{debugger;ae({xsbh:a.value.xsbh,zzjgdm:a.value.xifajgdm}).then(n=>{n===1?(U("撤回成功"),x.back()):U("撤回成功")}).finally(()=>{loading.value=!1})}).catch(()=>{})},_=()=>{console.log(a.value.zhuangtai,a.value.zhuangtai==="true"),a.value.zhuangtai||a.value.zhuangtai=="true"?U("该指令已完成，无需重复操作"):A({message:"是否完成？"}).then(()=>{ne({xsbh:m,zhuangtai:!0}).then(u=>{console.log("res",u),u===1&&te({bianhao:m}).then(n=>{v.value=[],j(),oe({message:"操作完成"})})})}).catch(()=>{})},y=()=>{a.value.db=="是"?U("该指令已被盯办，无需重复操作"):A({title:"盯办提示",message:"是否需要盯办？"}).then(()=>{Y.value.forEach(u=>{le({bianhao:u.xsbh,biaoti:u.biaoti,zzjgdm:u.hechadanweidm,zzjgmc:u.hechadanw,sfwc:"否",sjy:"指令",xfbm:V.userInfo.depname,xfbmdm:V.userInfo.depcode,wanchengshixian:I(u.wanchengshixian).format("YYYY-MM-DD HH:mm:ss"),xiafatime:I().format("YYYY-MM-DD HH:mm:ss")}).then(n=>{console.log(n+":")})}),se({db:"是",xsbh:a.value.xsbh}).then(u=>{ue("盯办成功！")})})},k=()=>{x.push({path:"/hcfk/directive/directive_forward",query:a.value})};return(u,n)=>{const i=s("van-field"),c=s("van-cell-group"),C=s("van-tag"),D=s("van-cell"),o=s("van-action-bar-icon"),R=s("van-action-bar"),T=s("van-form"),S=s("van-tab"),Z=s("van-tabs");return l(),d("div",ke,[e(Z,{active:M.value,"onUpdate:active":n[6]||(n[6]=r=>M.value=r)},{default:t(()=>[e(S,{title:"指令详情"},{default:t(()=>[e(T,{readonly:""},{default:t(()=>[e(c,{inset:"",style:{"margin-top":"20px"}},{default:t(()=>[a.value.zhuangtai?(l(),d("div",ze)):f("",!0),e(i,{modelValue:a.value.zhilingyaoq,"onUpdate:modelValue":n[0]||(n[0]=r=>a.value.zhilingyaoq=r),"label-align":"top",rows:"5",autosize:"",label:"指令要求",type:"textarea"},null,8,["modelValue"]),e(i,{modelValue:a.value.hechashixian,"onUpdate:modelValue":n[1]||(n[1]=r=>a.value.hechashixian=r),label:"核查时限","input-align":"right"},null,8,["modelValue"])]),_:1}),e(c,{inset:"",style:{"margin-top":"20px"}},{default:t(()=>[e(D,{title:"紧急状态"},{value:t(()=>[e(C,{plain:"",size:"medium",type:"primary"},{default:t(()=>[h(b(a.value.jingjizhuangtai),1)]),_:1})]),_:1}),e(D,{title:"业务员警种"},{value:t(()=>[e(C,{plain:"",size:"medium",type:"success"},{default:t(()=>[h(b(z(ce)(a.value.ywjzdm)),1)]),_:1})]),_:1}),e(i,{modelValue:a.value.xiafashijian,"onUpdate:modelValue":n[2]||(n[2]=r=>a.value.xiafashijian=r),label:"下发时间","input-align":"right"},null,8,["modelValue"]),e(i,{modelValue:a.value.xiafaren,"onUpdate:modelValue":n[3]||(n[3]=r=>a.value.xiafaren=r),label:"下发人","input-align":"right"},null,8,["modelValue"]),e(i,{modelValue:a.value.xiafabum,"onUpdate:modelValue":n[4]||(n[4]=r=>a.value.xiafabum=r),label:"下发单位","input-align":"right"},null,8,["modelValue"])]),_:1}),e(c,{inset:"",title:"主办单位"},{default:t(()=>[e(i,{modelValue:a.value.zhuban,"onUpdate:modelValue":n[5]||(n[5]=r=>a.value.zhuban=r),"input-align":"left"},null,8,["modelValue"])]),_:1}),e(c,{inset:"",title:"协办单位",style:{"margin-bottom":"20px"}},{default:t(()=>[v.value.length>0?(l(!0),d(B,{key:0},N(v.value,(r,L)=>(l(),g(i,{modelValue:v.value[L],"onUpdate:modelValue":$=>v.value[L]=$,"input-align":"left","label-align":"top"},null,8,["modelValue","onUpdate:modelValue"]))),256)):(l(),g(D,{key:1,title:"无协办单位"}))]),_:1}),e(R,{placeholder:""},{default:t(()=>[e(o,{icon:"revoke",text:"撤回",onClick:q}),e(o,{icon:"guide-o",text:"盯办",onClick:y}),e(o,{icon:"thumb-circle-o",text:"是否完成",onClick:_}),e(o,{icon:"share-o",text:"指令转发",onClick:k})]),_:1})]),_:1})]),_:1}),e(S,{title:"指令反馈"},{default:t(()=>[e(z(ye))]),_:1})]),_:1},8,["active"])])}}});const qe=J(we,[["__scopeId","data-v-1da8ae9c"]]);export{qe as default};
