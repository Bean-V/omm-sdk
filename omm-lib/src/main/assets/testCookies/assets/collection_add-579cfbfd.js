import{d as M,a as S,J as F,r as v,V as g,$ as I,C as T,f as d,o as H,g as R,h as n,z as t,a0 as m,j as B,Z as j,a1 as N,a2 as P,a3 as f,P as p,Q as V,a4 as A,a5 as y,a6 as $,a7 as J,R as Q}from"./index-24b7b5a4.js";const Z={style:{padding:"5px 16px",display:"flex","justify-content":"space-around"}},K=M({__name:"collection_add",setup(E){const c=S(),r=F(),u=v(!1),e=v({xsbh:g().format("YYYYMMDDHHmmss")+Math.floor(1e3+Math.random()*9999),biaoti:"",leixing:"",neirong:"",shejidiqu:"",laiyuan:"",caijidanwei:r.userInfo.depname,caijiren:r.userInfo.name,caijishijian:g().format("YYYY-MM-DD HH:mm:ss"),zhuyaorenyuan:"",sfz:"",sfzhm:r.userInfo.idcard,zzjgdm:r.userInfo.depcode,ywjzdm:"",sfsb:null,hechadanweidm:"1",zphone:r.userInfo.phone,mingzu:"",fenlei:"",dh:""}),z=[{text:"情指",value:"00"},{text:"国保",value:"01"},{text:"治安",value:"03"},{text:"刑侦",value:"05"}],q=v({}),b=v([]),_=[{text:"阿图什",value:"阿图什"},{text:"阿克陶",value:"阿克陶"},{text:"乌恰",value:"乌恰"},{text:"阿合奇",value:"阿合奇"},{text:"南疆四地州",value:"南疆四地州"},{text:"新疆",value:"新疆"},{text:"内地",value:"内地"},{text:"国外",value:"国外"}],w=[{text:"工作掌握",value:"工作掌握"},{text:"密悉掌握",value:"密悉掌握"},{text:"人力情报",value:"人力情报"},{text:"技术情报",value:"技术情报"},{text:"群众举报",value:"群众举报"},{text:"末梢信息",value:"末梢信息"},{text:"审讯深挖",value:"审讯深挖"},{text:"异地推送",value:"异地推送"},{text:"上级通报",value:"上级通报"}],D=[{text:"舆情",value:"舆情"},{text:"敌情",value:"敌情"},{text:"社情",value:"社情"},{text:"教情",value:"教情"}];I({leibie:"cjleibie"}).then(s=>{const a=s[0].map((o,i)=>(o={text:o,value:o},o));q.value=a,b.value.push(a)});const k=s=>{const a=new FormData;a.append("file",s.file),N("/gather/upload",a).then(o=>{console.log("path:",o),P({bianhao:e.value.xsbh,wenjian:s.file.name,path:o}).then(i=>{i&&f("附件上传成功")})})},U=()=>{if(!e.value.zzjgdm==="653000000000"){p({message:"您无需上报"});return}else V({title:"提示",message:"是否保存"}).then(()=>{e.value.sfsb=!1,A(e.value).then(s=>{Object.keys(s).length!=0?(f("保存成功"),u.value=!0):s.statusCode==403?p("无权限操作"):y("保存失败")})}).catch(()=>{})},O=()=>{if(!e.value.zzjgdm==="653000000000"){p({message:"您无需上报"});return}else if(e.value.sfsb==null){p({message:"请先保存后再上报"});return}else V({title:"提示",message:"是否上报"}).then(()=>{e.value.sfsb=!0,$(e.value.xsbh).then(s=>{if(s)y("上报失败");else{const a={bianhao:e.value.xsbh,biaoti:e.value.biaoti,ywjzdm:e.value.ywjzdm,sbzzjgdm:e.value.zzjgdm,sfzhmsbr:e.value.caijiren,sbzzjgmc:e.value.caijidanwei,dh:""};J(a).then(o=>{f("上报成功"),Q.back()})}})}).catch(()=>{})};return T(()=>{const s=c.query;s&&Object.keys(s).length>0&&(e.value={},e.value=c.query,e.value.neirong=c.query.neirong1)}),(s,a)=>{const o=d("DateTimePicker"),i=d("van-cell-group"),Y=d("van-uploader"),x=d("van-field"),h=d("van-button"),C=d("van-form");return H(),R(C,{onSubmit:U,disabled:u.value},{default:n(()=>[t(i,{inset:"",title:"基本信息"},{default:n(()=>[t(m,{modelValue:e.value.ywjzdm,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.ywjzdm=l),options:z,label:"业务警种",required:"",disabled:u.value,placeholder:"请点击选择",rules:[{required:!0,message:"请选择内容"}]},null,8,["modelValue","disabled"]),t(m,{modelValue:e.value.leixing,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.leixing=l),options:b.value,label:"采集类型",required:"",disabled:u.value,placeholder:"请点击选择",rules:[{required:!0,message:"请选择内容"}]},null,8,["modelValue","options","disabled"]),t(m,{modelValue:e.value.shejidiqu,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.shejidiqu=l),options:_,label:"涉及地区",required:"",disabled:u.value,placeholder:"请点击选择",rules:[{required:!0,message:"请选择内容"}]},null,8,["modelValue","disabled"]),t(m,{modelValue:e.value.laiyuan,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.laiyuan=l),options:w,label:"信息来源",required:"",disabled:u.value,placeholder:"请点击选择",rules:[{required:!0,message:"请选择内容"}]},null,8,["modelValue","disabled"]),t(m,{modelValue:e.value.siqing,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.siqing=l),options:D,label:"四情",required:"",disabled:u.value,placeholder:"请点击选择",rules:[{required:!0,message:"请选择内容"}]},null,8,["modelValue","disabled"]),t(o,{modelValue:e.value.caijishijian,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.caijishijian=l),label:"采集时间",placeholder:"请点击选择",disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),t(i,{inset:"",title:"附件上传"},{default:n(()=>[t(x,{name:"uploader","label-align":"top"},{input:n(()=>[t(Y,{modelValue:e.value.file,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.file=l),"after-read":k},null,8,["modelValue"])]),_:1})]),_:1}),t(i,{inset:"",title:"信息详情"},{default:n(()=>[t(x,{modelValue:e.value.neirong,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.neirong=l),"label-align":"top",rows:"5",autosize:"",type:"textarea",required:"",placeholder:"请输入内容","show-word-limit":"",rules:[{required:!0,message:"请填写内容"}]},null,8,["modelValue"])]),_:1}),B("div",Z,[t(h,{type:"success",block:"","native-type":"onSubmit",style:{width:"49%"}},{default:n(()=>[j(" 保存 ")]),_:1}),t(h,{type:"primary",block:"",onClick:O,style:{width:"49%"}},{default:n(()=>[j(" 上报 ")]),_:1})])]),_:1},8,["disabled"])}}});export{K as default};
