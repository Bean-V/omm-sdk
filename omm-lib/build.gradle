apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
apply plugin: 'maven-publish'

buildscript {
    ext {

//        appId = 'com.oortcloud.rjt' // Â••ÈôåÈôå//ommOA01
        channel = '@string/app_name' // bugly‰∏äÊòæÁ§∫ÁöÑÊ∏†ÈÅìÂêçÔºå

        buglyAppId = '438ff58c22' // buglyÈÖçÁΩÆÁöÑappId,
        baiduApiKey = 'Q7wb91P5U7RnKkcwOTu8AQtBpsujKmzu' // baiduÈÖçÁΩÆÁöÑapiKey,
        googleApiKey = 'AIzaSyAbJjDWUPU6sRsQccNMp8E3soO7YGSkTIg' // googleÂú∞ÂõæÈÖçÁΩÆÁöÑapiKey,
        huaweiAppId = '102058269' // Âçé‰∏∫Êé®ÈÄÅÈÖçÁΩÆÁöÑappId,
        xiaomiAppId = '2882303761517581074' // Â∞èÁ±≥Êé®ÈÄÅÈÖçÁΩÆÁöÑappId,
        xiaomiAppKey = '5951758130074' // Â∞èÁ±≥Êé®ÈÄÅÈÖçÁΩÆÁöÑappKey,
        meizuAppId = '118639' // È≠ÖÊóèÊé®ÈÄÅÈÖçÁΩÆÁöÑappId,
        meizuAppKey = '198cfa2fa66544ba87ab05874ba22868' // È≠ÖÊóèÊé®ÈÄÅÈÖçÁΩÆÁöÑappKey,
        vivoAppId = '18094' // VIVOÊé®ÈÄÅÈÖçÁΩÆÁöÑappId,
        vivoAppKey = '41337891-3989-4db0-8894-6ecbf313cefd' // VIVOÊé®ÈÄÅÈÖçÁΩÆÁöÑappKey,
        oppoAppKey = 'dIHycN8J0NsCokwSGss8sskw4' // OPPOÊé®ÈÄÅÈÖçÁΩÆÁöÑappKey,
        oppoAppSecret = 'b9f6927d9eCD0159532dA5c2e1118eC8' // OPPOÊé®ÈÄÅÈÖçÁΩÆÁöÑsecret,
        wechatAppId = '' // ÂæÆ‰ø°Áõ∏ÂÖ≥ÁöÑappId,
        qqAppId = '' // QQÁõ∏ÂÖ≥ÁöÑappId,

        buglyAppChannel = channel
        date = new Date().format("yyyyMMdd")
        buglyVersionNameSuffix = '' + '-' + date
    }
}
// Âà§Êñ≠Â≠òÂú®Ë∞∑Ê≠åÊúçÂä°ÈÖçÁΩÆÊñá‰ª∂ÊâçÂêØÁî®Ë∞∑Ê≠åÊúçÂä°Ôºå
def googleJson = file('google-services.json')
if (googleJson.exists() && googleJson.readLines().any { it.contains(appId) }) {
    apply plugin: 'com.google.gms.google-services'
    // Ë∞∑Ê≠åÊúçÂä°4.2ÁâàÊú¨ÊúâÂ∑≤Áü•bug‰ºöÂØºËá¥ÂÖ∂‰ªñÊó†ÂÖ≥‰æùËµñ(smack4.3.4)Ëé´ÂêçÂÜ≤Á™ÅÔºåÁ¶ÅÁî®Áõ∏ÂÖ≥Ê£ÄÊü•Ëß£ÂÜ≥Ôºå
    // https://github.com/invertase/react-native-firebase/issues/1676
    //noinspection UnnecessaryQualifiedReference
    com.google.gms.googleservices.GoogleServicesPlugin.config.disableVersionCheck = true
}
android {
    lintOptions {
        abortOnError false
        checkReleaseBuilds false
    }

    packagingOptions {//Âä†‰∏äËøô‰∫õ‰ª£Á†Å
        pickFirst 'lib/armeabi-v7a/libijkplayer.so'
        pickFirst 'lib/armeabi-v8a/libijkplayer.so'
        pickFirst 'lib/arm64-v8a/libijkplayer.so'
        pickFirst 'lib/x86/libijkplayer.so'
        pickFirst 'lib/x86_64/libijkplayer.so'

        pickFirst 'lib/armeabi-v7a/libijksdl.so'
        pickFirst 'lib/armeabi-v8a/libijksdl.so'
        pickFirst 'lib/arm64-v8a/libijksdl.so'
        pickFirst 'lib/x86/libijksdl.so'
        pickFirst 'lib/x86_64/libijksdl.so'

        pickFirst 'lib/armeabi-v7a/libijkffmpeg.so'
        pickFirst 'lib/armeabi-v8a/libijkffmpeg.so'
        pickFirst 'lib/arm64-v8a/libijkffmpeg.so'
        pickFirst 'lib/x86/libijkffmpeg.so'
        pickFirst 'lib/x86_64/libijkffmpeg.so'

        pickFirst 'lib/*/libc++_shared.so'

        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/NOTICE.txt'

        exclude 'META-INF/*.kotlin_module'
        exclude 'META-INF/rxjava.properties'
    }

    compileSdkVersion compile_version

    namespace "com.oort.weichat"

    defaultConfig {
//        applicationId appId


        buildFeatures {
            buildConfig true
            aidl true
        }
        //ÁâàÊú¨Âè∑Ôºå‰∏çË¶ÅÂá∫Áé∞4‰∫Ü
        versionCode     1013
        versionName "1.0.13" //ÁâàÊú¨Âè∑Ôºå‰∏çË¶ÅÂá∫Áé∞4‰∫Ü
        //ÁâàÊú¨Âè∑Ôºå‰∏çË¶ÅÂá∫Áé∞4‰∫Ü
        minSdkVersion min_version
        targetSdkVersion target_version

        vectorDrawables.useSupportLibrary = true

        ndk {

            abiFilters 'arm64-v8a'
            //abiFilters  "armeabi",//"armeabi-v7a" //,"x86_64"
//             abiFilters "armeabi", "armeabi-v7a", "arm64-v8a", "x86", "x86_64"

        }

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        multiDexEnabled = true
        buildConfigField('String', "BUGLY_APP_ID", '"' + buglyAppId + '"')
        buildConfigField('String', "BUGLY_APP_CHANNEL", '"' + buglyAppChannel + '"')
        buildConfigField('String', "XIAOMI_APP_ID", '"' + xiaomiAppId + '"')
        buildConfigField('String', "XIAOMI_APP_KEY", '"' + xiaomiAppKey + '"')
        buildConfigField('String', "MEIZU_APP_ID", '"' + meizuAppId + '"')
        buildConfigField('String', "MEIZU_APP_KEY", '"' + meizuAppKey + '"')
        buildConfigField('String', "OPPO_APP_KEY", '"' + oppoAppKey + '"')
        buildConfigField('String', "OPPO_APP_SECRET", '"' + oppoAppSecret + '"')
        buildConfigField('String', "GOOGLE_API_KEY", '"' + googleApiKey + '"')
        buildConfigField('String', "WECHAT_APP_ID", '"' + wechatAppId + '"')
        buildConfigField('String', "QQ_APP_ID", '"' + qqAppId + '"')
        manifestPlaceholders = [
//                APP_ID        : appId,
            BAIDU_API_KEY : baiduApiKey,
            VIVO_APP_ID   : vivoAppId,
            VIVO_APP_KEY  : vivoAppKey,
            GOOGLE_API_KEY: googleApiKey,
            HUAWEI_APP_ID : huaweiAppId,
            QQ_APP_ID     : qqAppId,
        ]

        resConfigs "en", "zh-rCN","ar"
        externalNativeBuild {
            cmake {
                arguments "-DANDROID_SUPPORT_FLEXIBLE_PAGE_SIZES=ON", "-DANDROID_STL=c++_shared"
                cppFlags "-std=c++17"
                cFlags "-DANDROID_PLATFORM=android-26"
            }
        }
    }

    // È´òÁâàÊú¨as‰∏≠installRelease‰∏ç‰ºö‰æùËµñassembleRelease‰πüÂ∞±‰∏ç‰ºöÂ§çÂà∂apk,
    afterEvaluate {
        // Ê≤°ÈÖçÁΩÆÁ≠æÂêçÁöÑËØùÔºåÂ∞±Ê≤°ÊúâinstallReleaseÔºå
        if (tasks.findByName('installRelease')) {
            installRelease.dependsOn 'assembleRelease'
        }
    }
    // multiDexÁöÑ‰∏Ä‰∫õÁõ∏ÂÖ≥ÈÖçÁΩÆÔºåËøôÊ†∑ÈÖçÁΩÆÂèØ‰ª•ËÆ©‰Ω†ÁöÑÁºñËØëÈÄüÂ∫¶Êõ¥Âø´
    dexOptions {
        // ËÆ©ÂÆÉ‰∏çË¶ÅÂØπLibÂÅöpreDexing
        preDexLibraries = false
        // ÂºÄÂêØincremental dexing,‰ºòÂåñÁºñËØëÊïàÁéáÔºåËøô‰∏™ÂäüËÉΩandroid studioÈªòËÆ§ÊòØÂÖ≥Èó≠ÁöÑ
        // incremental true
        // Â¢ûÂä†javaÂ†ÜÂÜÖÂ≠òÂ§ßÂ∞è
        javaMaxHeapSize "4g"
    }

    // ÂçïÂÖÉÊµãËØïÁî®Ôºå
    testOptions {
        unitTests.returnDefaultValues = true
    }

    // ËøõË°åJAVA ÁöÑÁâàÊú¨ÈÖçÁΩÆÔºå‰ΩøÁî®ÂØπÂ∫îÁâàÊú¨ÁöÑ‰∏Ä‰∫õÊñ∞ÁâπÊÄß
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    useLibrary 'org.apache.http.legacy'



    buildTypes {
        release {
            minifyEnabled false

            //  minifyEnabled true // ÂèØ‰øùÁïôÊ∑∑Ê∑ÜÔºå‰ΩÜÈúÄÈÖçÂêà‰∏äËø∞ ProGuard ËßÑÂàô
            shrinkResources false // ÂÖ≥ÈîÆÔºöÂÖ≥Èó≠ËµÑÊ∫êÂéãÁº©ÔºåÈÅøÂÖç config.xml ÁªìÊûÑË¢´Êîπ
            // Ê∑∑Ê∑ÜÊñá‰ª∂‰ΩçÁΩÆ
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField('String', "VERSION_NAME_SUFFIX", '"' + buglyVersionNameSuffix + '"')
        }
        debug {
            buildConfigField('String', "VERSION_NAME_SUFFIX", '"' + "-DEBUG" + '"')
            debuggable true
        }
    }

    // Á≠æÂêç‰ø°ÊÅØ‰ªésigning.properties‰∏≠Ëé∑ÂèñÔºå
    // debugÂíårelease‰ΩøÁî®Áõ∏ÂêåÁ≠æÂêçÔºå‰ª•‰æøÁî®debugÂåÖË¶ÜÁõñreleaseÂåÖ‰ªéËÄåË∞ÉËØïÔºå
    // Â¶ÇÊûúÊ≤°ÊúâÔºåÂ∞±‰ºö‰ΩøÁî®ÈªòËÆ§debugÁ≠æÂêçÔºå
    def signingFile = rootProject.file('signing.properties')
    if (signingFile.exists()) {
        def input = signingFile.newInputStream()
        def p = new Properties()
        p.load(input)
        // Á≠æÂêçÊñá‰ª∂Â≠òÂú®ÊâçÈÖçÁΩÆÁ≠æÂêçÔºå
        def jks = rootProject.file(p['storeFile'])
        if (jks.exists()) {
            signingConfigs {
                config {
                    keyAlias p['keyAlias']
                    keyPassword p['keyPassword']
                    storeFile jks
                    storePassword p['storePassword']
                    v1SigningEnabled true
                    v2SigningEnabled true
                }
            }
            buildTypes {
                debug {
                    signingConfig signingConfigs.config
                }
                release {
                    signingConfig signingConfigs.config
                }
            }
        }
    }
    repositories {
        mavenLocal()  // ‚Üê ËøôË°åÂæàÈáçË¶ÅÔºÅ
        // ‰πüÂèØ‰ª•ÊòæÂºèÊåáÂÆöÊú¨Âú∞‰ªìÂ∫ìË∑ØÂæÑ
        maven {
            url = uri("${System.getProperty('user.home')}/.m2/repository")
        }
//
//        flatDir {
//            dirs '../OortWebframeLib/libs'   // aarÁõÆÂΩï
//        }


    }
}

configurations.all {
    resolutionStrategy.eachDependency { details ->
        // jitsiÂíåimaging‰∏§‰∏™Â∫ìÈÉΩ‰æùËµñfrescoÁâàÊú¨ÂÜ≤Á™Å‰∫ÜÔºå
//        if (details.requested.group == 'com.facebook.fresco') {
//            details.useVersion '2.0.0'
//        }
    }
    // 1.1.0‰ºöÂØºËá¥ÂÆâÂçì5‰∏äwebviewÂ¥©Ê∫ÉÔºåhttps://stackoverflow.com/a/58131421
    // ÂáÜÁ°ÆËØ¥ÊòØ‰ΩéÁâàÊú¨webViewÁöÑbugÔºåÊôÆÈÅçÂ≠òÂú®ÂõΩ‰∫ßÂÆâÂçì5‰∏äÔºå
    resolutionStrategy.force 'androidx.appcompat:appcompat:1.3.1'
}

configurations.maybeCreate("publishAar")

// Âú®Êñá‰ª∂È°∂ÈÉ®ÂÆö‰πâÂèòÈáè
// JitPack ÊûÑÂª∫Êó∂‰πüÂ∫îËØ•‰ΩøÁî®Êú¨Âú∞È°πÁõÆ‰æùËµñÔºåÂõ†‰∏∫ÊâÄÊúâÊ®°ÂùóÈÉΩÂú®Âêå‰∏Ä‰∏™‰ªìÂ∫ì‰∏≠
def isLocalBuild = true  // ÂßãÁªà‰ΩøÁî®Êú¨Âú∞È°πÁõÆ‰æùËµñ
dependencies {
    // ========== AndroidX Ê†∏ÂøÉÂ∫ì ==========
    implementation 'androidx.appcompat:appcompat:1.3.1'
    implementation 'com.google.android.material:material:1.4.0'
    implementation 'androidx.recyclerview:recyclerview:1.2.1'
    implementation 'androidx.gridlayout:gridlayout:1.0.0'
    implementation 'androidx.cardview:cardview:1.0.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    implementation 'androidx.multidex:multidex:2.0.1'
    implementation 'androidx.legacy:legacy-support-v4:1.0.0'
    implementation libs.fragment
    implementation 'com.google.android.flexbox:flexbox:3.0.0'

    // ========== È°πÁõÆÊ®°Âùó‰æùËµñ ==========
    if (isLocalBuild) {
        // ÂºÄÂèëÊó∂‰ΩøÁî®Êú¨Âú∞Ê®°Âùó
        implementation project(path: ':oort_imagepick_sdk')
        implementation project(path: ':ToolsMain')
        implementation project(path: ':provider_lib')
        implementation project(path: ':pullToRefershLibraryMy')
        implementation project(path: ':jcvideoplayer-lib')
        implementation project(path: ':YZxing-lib')
        implementation project(path: ':OpenGLlibrary')
        implementation project(path: ':MPChartLib')
        implementation project(path: ':liveLibrary')
        implementation project(path: ':OortWebframeLib')
        implementation project(path: ':basemodule')
        implementation project(path: ':AppStore')
        implementation project(path: ':Contacts')
        implementation project(path: ':screenrecorder')
        implementation project(path: ':AIDICert')
        implementation project(path: ':sound_recon')
        implementation project(path: ':FrameLibrary')
        implementation project(path: ':Levc-lib')
        implementation project(path: ':giraffeplayer')
        implementation project(path: ':floatview')
        implementation project(path: ':offline')
    } else {
        // ÂèëÂ∏ÉÊó∂‰ΩøÁî®ËøúÁ®ã‰æùËµñÔºàJitPackÊûÑÂª∫Ôºâ
        implementation 'com.github.Bean-V:oort_imagepick_sdk:1.0.0'
        implementation 'com.github.Bean-V:ToolsMain:1.0.0'
        implementation 'com.github.Bean-V:provider_lib:1.0.0'
        implementation 'com.github.Bean-V:pullToRefershLibraryMy:1.0.0'
        implementation 'com.github.Bean-V:jcvideoplayer-lib:1.0.0'
        implementation 'com.github.Bean-V:YZxing-lib:1.0.0'
        implementation 'com.github.Bean-V:OpenGLlibrary:1.0.0'
        implementation 'com.github.Bean-V:MPChartLib:1.0.0'
        implementation 'com.github.Bean-V:liveLibrary:1.0.0'
        implementation 'com.github.Bean-V:OortWebframeLib:1.0.0'
        implementation 'com.github.Bean-V:basemodule:1.0.0'
        implementation 'com.github.Bean-V:AppStore:1.0.0'
        implementation 'com.github.Bean-V:Contacts:1.0.0'
        implementation 'com.github.Bean-V:screenrecorder:1.0.0'
        implementation 'com.github.Bean-V:AIDICert:1.0.0'
        implementation 'com.github.Bean-V:sound_recon:1.0.0'
        implementation 'com.github.Bean-V:FrameLibrary:1.0.0'
        implementation 'com.github.Bean-V:Levc-lib:1.0.0'
        implementation 'com.github.Bean-V:giraffeplayer:1.0.0'
        implementation 'com.github.Bean-V:floatview:1.0.0'
        implementation 'com.github.Bean-V:offline:1.0.0'
    }

    // ========== Êï∞ÊçÆÂ∫ìÁõ∏ÂÖ≥ ==========
    implementation 'androidx.room:room-runtime:2.3.0'
    kapt "androidx.room:room-compiler:2.3.0"
    implementation 'org.litepal.android:core:1.6.1'
    debugImplementation 'com.amitshekhar.android:debug-db:1.0.6' // ‰ªÖdebug

    // ========== ÁΩëÁªúËØ∑Ê±Ç ==========
    implementation 'com.squareup.okhttp3:okhttp:3.2.0'
    implementation 'com.squareup.okhttp3:logging-interceptor:4.11.0'
    implementation files('libs/android-async-http-1.4.5.jar')

    // Retrofit + RxJava
    implementation "com.squareup.retrofit2:retrofit:2.4.0"
    implementation "com.squareup.retrofit2:converter-gson:2.4.0"
    implementation "com.squareup.retrofit2:adapter-rxjava2:2.4.0"
    implementation "io.reactivex.rxjava2:rxjava:2.2.3"
    implementation "io.reactivex.rxjava2:rxandroid:2.1.0"

    // ========== ÂõæÁâáÂ§ÑÁêÜ ==========
    implementation 'com.github.bumptech.glide:glide:3.7.0'
    compileOnly 'com.github.bumptech.glide:glide:4.9.0'  // ‰æùËµñ‰ΩÜ‰∏çÁî®ÊâìÂåÖ
    implementation 'com.github.bumptech.glide:glide:4.12.0'
    implementation files('libs/universal-image-loader-1.9.0.jar')
    implementation 'com.makeramen:roundedimageview:2.3.0'  // ÂúÜÂΩ¢ÂõæÁâá
    implementation 'top.zibin:Luban:1.1.3'  // ÂõæÁâáÂéãÁº©
    implementation 'cc.aoeiuv020:imaging:1.0'  // ÂõæÁâáÁºñËæë

    // ========== Èü≥ËßÜÈ¢ëÂ§ÑÁêÜ ==========
    implementation('com.github.AoEiuV020:jjdxm_ijkplayer:1.1.1') {
        exclude group: 'com.android.support', module: 'appcompat-v7'
    }
    implementation 'com.github.ctiao:DanmakuFlameMaster:0.5.3'
    implementation 'tyrant:heartlayout:1.0.1'
    implementation 'org.jitsi.react:jitsi-meet-sdk:11.5.1'
    implementation 'com.danikula:videocache:2.7.1'  // ËßÜÈ¢ëÁºìÂ≠ò
    implementation 'com.github.yangjie10930:EpMedia:v0.9.5'  // ËßÜÈ¢ëÂ§ÑÁêÜ
    implementation 'pl.droidsonroids.gif:android-gif-drawable:1.2.28'  // GIF
    implementation 'com.huangyz0918:androidwm-light:0.1.2'  // ÂõæÁâáÊ∞¥Âç∞

    // ========== Êé®ÈÄÅÊúçÂä° ==========
    // Â∞èÁ±≥
    implementation files('libs/MiPush_SDK_Client_3_6_18.jar')
    // Âçé‰∏∫
    implementation 'com.huawei.android.hms:push:2.5.2.300'
    implementation 'com.huawei.android.hms:base:2.5.2.300'
    // È≠ÖÊóè
    implementation 'com.meizu.flyme.internet:push-internal:3.8.1@aar'
    // vivo
    implementation files('libs/vivopushsdk_v2.3.4.jar')
    // oppo
    implementation files('libs/mcssdk-1.0.1.jar')
    // Firebase
    implementation 'com.google.firebase:firebase-core:16.0.9'
    implementation 'com.google.firebase:firebase-messaging:18.0.0'

    // ========== Á¨¨‰∏âÊñπÁôªÂΩï/ÊîØ‰ªò ==========
    // ÊîØ‰ªòÂÆù
    implementation 'com.alipay.sdk:alipaysdk-android:15.8.11'
    // QQÁôªÂΩï
    implementation files('libs/open_sdk_r6199_lite.jar')
    // ÂæÆ‰ø°
    implementation 'com.tencent.mm.opensdk:wechat-sdk-android-with-mta:1.0.2'

    // ========== UIÁªÑ‰ª∂ ==========
    implementation 'com.scwang.smartrefresh:SmartRefreshLayout:1.1.0-alpha-28'  // ‰∏ãÊãâÂà∑Êñ∞
    implementation 'me.leolin:ShortcutBadger:1.1.22'  // ËßíÊ†á
    implementation 'com.hyman:flowlayout-lib:1.1.2'  // ÊµÅÂºèÂ∏ÉÂ±Ä
    implementation 'in.srain.cube:grid-view-with-header-footer:1.0.12'  // GridView
    implementation 'com.github.zcweng:switch-button:0.0.3@aar'  // ÂºÄÂÖ≥ÊåâÈíÆ
    implementation 'com.daimajia.numberprogressbar:library:1.4@aar'  // ËøõÂ∫¶Êù°
    implementation 'com.github.ceryle:FitGridView:v1.0.5'  // Ë°®Ê†ºÈù¢Êùø
    implementation 'me.imid.swipebacklayout.lib:library:1.1.0'  // ‰æßÊªëËøîÂõû
    implementation 'com.leo618:zip:0.0.1'  // Âø´ÈÄüSharedPreferences
    implementation 'com.joybar.calendar:librarycalendar:1.0.6'  // Êó•ÂéÜ
    implementation 'com.contrarywind:Android-PickerView:4.1.7'  // ÈÄâÊã©Âô®
    implementation 'com.github.xuexiangjys:XUI:1.2.1'  // UIÊ°ÜÊû∂
    implementation 'com.github.xuexiangjys:XUpdate:2.1.4'  // Êõ¥Êñ∞Ê°ÜÊû∂

    // ========== Âú∞ÂõæÂÆö‰Ωç ==========
    implementation files('libs/BaiduLBS_Android.jar')
    implementation 'com.google.android.gms:play-services-maps:16.1.0'
    implementation 'com.google.android.gms:play-services-location:16.0.0'

    // ========== Âç≥Êó∂ÈÄöËÆØ ==========
    var smackVersion = "4.4.6"
    implementation "org.igniterealtime.smack:smack-tcp:$smackVersion"
    implementation "org.igniterealtime.smack:smack-im:$smackVersion"
    implementation "org.igniterealtime.smack:smack-extensions:$smackVersion"
    implementation "org.igniterealtime.smack:smack-xmlparser-xpp3:$smackVersion"
    implementation "org.igniterealtime.smack:smack-experimental:$smackVersion"
    implementation "org.igniterealtime.smack:smack-android:$smackVersion"
    implementation "org.igniterealtime.smack:smack-sasl-provided:$smackVersion"
    implementation "org.igniterealtime.smack:smack-resolver-minidns:$smackVersion"

    // ========== Êï∞ÊçÆÂ§ÑÁêÜ ==========
    implementation 'org.greenrobot:eventbus:3.1.1'
    compileOnly files('libs/fastjson-1.2.40.jar')
    implementation 'com.belerweb:pinyin4j:2.5.0'  // ÊãºÈü≥
    implementation 'org.jsoup:jsoup:1.10.3'  // HTMLËß£Êûê
    implementation 'com.jakewharton.threetenabp:threetenabp:1.4.6'  // Êó∂Èó¥Â§ÑÁêÜ

    // ========== ÂÆâÂÖ®Âä†ÂØÜ ==========
    implementation 'org.bouncycastle:bcprov-jdk15on:1.57'
    implementation 'org.bouncycastle:bcprov-jdk15on:1.68'
    implementation 'org.bouncycastle:bcpkix-jdk15on:1.68'
    implementation 'io.jsonwebtoken:jjwt:0.9.1'  // JWT

    // ========== Êñá‰ª∂Êìç‰Ωú ==========
    implementation files('libs/httpmime-4.2.jar')
    compileOnly 'com.leo618:zip:0.0.1'

    // ========== Êú¨Âú∞JAR/AARÊñá‰ª∂ ==========
    implementation files('libs/all-20230425.jar')
    implementation files('../provider_lib/libs/JITLogSupport1.0.0.jar')
    implementation files('libs/nineoldandroids.jar')
    implementation files('libs/ormlite-android-4.48.jar')
    implementation files('libs/ormlite-core-4.48.jar')

    // ========== ÊµãËØïÁõ∏ÂÖ≥ ==========
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'androidx.test.ext:junit:1.1.1'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'

    // ========== ÂÖ∂‰ªñÂ∑•ÂÖ∑Â∫ì ==========
    implementation 'com.tencent.bugly:crashreport:4.1.9'  // Â¥©Ê∫É‰∏äÊä•
    implementation 'com.facebook.react:react-native:0.77.2'  //
//    implementation libs.react.native
    implementation 'androidx.work:work-runtime:2.7.1'  // ÂêéÂè∞‰ªªÂä°
    implementation "log4j:log4j:1.2.17"  // Êó•Âøó
    implementation 'com.jeremyliao:fast-sharedpreferences:0.0.1'  // Âø´ÈÄüÂ≠òÂÇ®
    implementation('com.github.chrisbanes.bitmapcache:library:2.3') {  // BitmapÁºìÂ≠ò
        exclude group: 'com.google.android', module: 'support-v4'
    }

    // ========== Â∑≤Ê≥®ÈáäÁöÑ‰æùËµñÔºà‰øùÁïô‰æõÂèÇËÄÉÔºâ ==========
    /*
    //    implementation files('libs/simkeylibrary-release.aar')
    //    ÁßëËææËßÜÈ¢ëÊí≠ÊîæÂô®
    //    implementation files('libs/kplayer-androidx-5.0.5-20240704-1.aar')
    //    implementation "com.kedacom.android:kplayer:5.0.5-20240704"
    //    implementation "com.kedacom:kplayer-androidx:5.0.5"
    //    ÊîØ‰ªòÂÆùÊóßÁâà
    //    implementation files('libs/alipaySdk-15.5.9-20181123210601.aar')
    //    ÂÖ∂‰ªñSDK
    //    implementation files('libs/xjgarsdklibrary-release-9.2.1-2019-08-31.aar')
    //    implementation 'libs/xjgarsdklibrary-release-9.2.1-2019-08-31.aar'
    //    Â§áÊ°àËØªÂèñ
    //    implementation files('libs/libfriapkrecord-r1.0.1.aar')
    //    implementation 'local.omm-lib:simkeylibrary-release:1.0.0'
    //    implementation 'local.omm-lib:kplayer-androidx-5.0.5-20240704-1:1.0.0'
    //    implementation 'local.omm-lib:alipaySdk-15.5.9-20181123210601:1.0.0'
    //    implementation 'local.omm-lib:xjgarsdklibrary-release-9.2.1-2019-08-31:1.0.0'
    //    implementation 'local.omm-lib:libfriapkrecord-r1.0.1:1.0.0'
    //    implementation 'com.github.ForgetAll:LoadingDialog:v1.0.1'
    //    implementation files('libs/glide-3.7.0.jar')
    //    implementation "org.jitsi.react:jitsi-meet-sdk:9.2.2"
    */
}

configurations {
    all*.exclude group: 'xpp3', module: 'xpp3'
}

// ËÆæÁΩÆÁâàÊú¨ÂíåÁªÑ
//version = '1.0.0'
//group = 'com.oort'
//afterEvaluate {
//    publishing {
//        publications {
//            release(MavenPublication) {
//                from components.release  // ‚úÖ Ëá™Âä®ÂåÖÂê´‰æùËµñ‰ø°ÊÅØ
//
//                // ËÆæÁΩÆ Maven ÂùêÊ†á
//                groupId = group
//                artifactId = 'omm-lib'
//                version = version
//
//                // ÂèØÈÄâÔºöÊ∑ªÂä†ÊèèËø∞Á≠â‰ø°ÊÅØ
//                pom {
//                    description = 'OMM-SDK'
//                }
//            }
//        }
//    }
//}

// ÂÆö‰πâÊâ©Â±ïÂ±ûÊÄßÔºå‰æø‰∫éÁÆ°ÁêÜ
ext {
    PUBLISH_GROUP_ID = 'com.github.Bean-V'
    PUBLISH_ARTIFACT_ID = 'omm-sdk'  // ÂøÖÈ°ª‰∏éGitHub‰ªìÂ∫ìÂêç‰∏ÄËá¥ÔºÅ
    PUBLISH_VERSION = '1.0.0'
}

afterEvaluate {
    // Âú®Èó≠ÂåÖÂ§ñÈÉ®ÊçïËé∑ kotlin_versionÔºåÈÅøÂÖçÈÖçÁΩÆÁºìÂ≠òÈóÆÈ¢ò
    def kotlinVersion = rootProject.ext.kotlin_version
    
    publishing {
        publications {
            release(MavenPublication) {
                // ‚ö†Ô∏è ÂÖ≥ÈîÆ‰øÆÊîπÔºö‰∏ç‰ΩøÁî® from components.release
                // ÂéüÂõ†Ôºöfrom components.release ‰ºöÂú® POM ‰∏≠Â£∞ÊòéÊâÄÊúâÈ°πÁõÆ‰æùËµñ
                // ‰ΩÜËøô‰∫õ‰æùËµñÂú® JitPack ‰∏ä‰∏çÂ≠òÂú®ÔºåÂØºËá¥Á¨¨‰∏âÊñπÊó†Ê≥ïËß£Êûê
                
                // ÊñπÊ°àÔºöÁõ¥Êé•ÂèëÂ∏ÉÂêàÂπ∂ÂêéÁöÑÂÆåÊï¥ AARÔºå‰∏çÂ£∞ÊòéÈ°πÁõÆ‰æùËµñ
                // from components.release  // ‚ùå Ê≥®ÈáäÊéâ
                
                // ‰ΩøÁî®ÂÆö‰πâÁöÑÂ±ûÊÄß
                groupId = PUBLISH_GROUP_ID
                artifactId = PUBLISH_ARTIFACT_ID
                version = PUBLISH_VERSION
                
                // ‚úÖ ÊâãÂä®ÊåáÂÆöË¶ÅÂèëÂ∏ÉÁöÑ AAR Êñá‰ª∂
                // Â¶ÇÊûú release-complete.aar Â≠òÂú®Ôºå‰ΩøÁî®ÂÆÉÔºõÂê¶Âàô‰ΩøÁî®Âü∫Á°Ä AAR
                artifact(project.provider {
                    def completeAar = new File(project.buildDir, "outputs/aar/release-complete.aar")
                    def baseAar = new File(project.buildDir, "outputs/aar/${project.name}-release.aar")
                    
                    if (completeAar.exists()) {
                        println "üì¶ [ÂèëÂ∏É] ‰ΩøÁî®ÂÆåÊï¥ AAR: ${completeAar.name} (${String.format("%.2f", completeAar.size() / 1024 / 1024)} MB)"
                        return completeAar
                    } else if (baseAar.exists()) {
                        println "‚ö†Ô∏è  [ÂèëÂ∏É] ÂÆåÊï¥ AAR ‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®Âü∫Á°Ä AAR: ${baseAar.name}"
                        return baseAar
                    } else {
                        throw new GradleException("‚ùå Êú™ÊâæÂà∞ÂèØÂèëÂ∏ÉÁöÑ AAR Êñá‰ª∂")
                    }
                })

                pom {
                    name = PUBLISH_ARTIFACT_ID
                    description = 'OMM Android SDK - Complete AAR with all dependencies'
                    url = "https://github.com/Bean-V/${PUBLISH_ARTIFACT_ID}"

                    licenses {
                        license {
                            name = 'Apache License 2.0'
                            url = 'https://www.apache.org/licenses/LICENSE-2.0.txt'
                        }
                    }

                    developers {
                        developer {
                            id = 'Bean-V'
                            name = 'Bean V'
                            email = 'your-email@example.com'
                        }
                    }

                    scm {
                        connection = "scm:git:git://github.com/Bean-V/${PUBLISH_ARTIFACT_ID}.git"
                        developerConnection = "scm:git:ssh://github.com/Bean-V/${PUBLISH_ARTIFACT_ID}.git"
                        url = "https://github.com/Bean-V/${PUBLISH_ARTIFACT_ID}"
                    }
                    
                    // ‚úÖ ÂÖ≥ÈîÆÔºöÊòéÁ°ÆÂ£∞ÊòéÊ≤°ÊúâÈ°πÁõÆ‰æùËµñ
                    // ÊâÄÊúâ‰æùËµñÈÉΩÂ∑≤ÁªèÂêàÂπ∂Âà∞ AAR ‰∏≠‰∫Ü
                    withXml {
                        def dependenciesNode = asNode().appendNode('dependencies')
                        
                        // Âè™‰øùÁïôÂøÖË¶ÅÁöÑÂ§ñÈÉ®‰æùËµñÔºàAndroidX„ÄÅKotlin Á≠âÔºâ
                        // Ëøô‰∫õ‰æùËµñÈÄöÂ∏∏Á¨¨‰∏âÊñπÈ°πÁõÆ‰πü‰ºöÊúâÔºå‰∏ç‰ºöÂÜ≤Á™Å
                        def essentialDeps = [
                            // AndroidX Ê†∏ÂøÉÂ∫ì
                            [group: 'androidx.appcompat', name: 'appcompat', version: '1.3.1'],
                            [group: 'com.google.android.material', name: 'material', version: '1.4.0'],
                            [group: 'androidx.recyclerview', name: 'recyclerview', version: '1.2.1'],
                            [group: 'androidx.constraintlayout', name: 'constraintlayout', version: '2.1.4'],
                            
                            // Kotlin
                            [group: 'org.jetbrains.kotlin', name: 'kotlin-stdlib', version: kotlinVersion],
                        ]
                        
                        essentialDeps.each { dep ->
                            def dependencyNode = dependenciesNode.appendNode('dependency')
                            dependencyNode.appendNode('groupId', dep.group)
                            dependencyNode.appendNode('artifactId', dep.name)
                            dependencyNode.appendNode('version', dep.version)
                            dependencyNode.appendNode('scope', 'compile')
                        }
                        
                        println "‚úÖ [POM] Â∑≤ÈÖçÁΩÆÊúÄÂ∞è‰æùËµñÈõÜÔºà${essentialDeps.size()} ‰∏™Ôºâ"
                    }
                }
            }
        }
    }
}


// ================================================
// Variant API: ÂêàÂπ∂ÊâÄÊúâ‰æùËµñÂà∞Âçï‰∏™ AAR
// ================================================

import com.android.build.api.variant.AndroidComponentsExtension
import org.gradle.api.DefaultTask
import org.gradle.api.file.DirectoryProperty
import org.gradle.api.file.RegularFileProperty
import org.gradle.api.file.ConfigurableFileCollection
import org.gradle.api.tasks.InputDirectory
import org.gradle.api.tasks.InputFiles
import org.gradle.api.tasks.OutputFile
import org.gradle.api.tasks.TaskAction
import org.gradle.api.artifacts.ProjectDependency
import java.util.jar.JarOutputStream
import java.util.zip.ZipEntry

// Ëá™ÂÆö‰πâ‰ªªÂä°ÔºöÂêàÂπ∂ÊâÄÊúâ‰æùËµñÂà∞ AAR
abstract class MergeAllDependenciesTask extends DefaultTask {
    
    @InputDirectory
    abstract DirectoryProperty getAarDirectory()
    
    @InputFiles
    abstract ConfigurableFileCollection getDependencyFiles()
    
    @OutputFile
    abstract RegularFileProperty getOutputAar()
    
    @TaskAction
    void mergeAllDependencies() {
        println "üîÑ [Variant API] ÂºÄÂßãÂêàÂπ∂ÊâÄÊúâ‰æùËµñ..."
        
        // Êü•ÊâæÂéüÂßã AAR
        def aarDir = aarDirectory.get().asFile
        def originalAar = aarDir.listFiles()?.find { it.name.endsWith('.aar') && it.name.contains('release') }
        
        if (!originalAar || !originalAar.exists()) {
            println "‚ùå ÂéüÂßã AAR ‰∏çÂ≠òÂú®‰∫é: ${aarDir.path}"
            throw new GradleException("Original AAR not found")
        }
        
        println "üì¶ ÊâæÂà∞ÂéüÂßã AAR: ${originalAar.name} (${String.format("%.2f", originalAar.size() / 1024 / 1024)} MB)"
        
        // ÂàõÂª∫‰∏¥Êó∂ÁõÆÂΩï
        def tempDir = new File(project.buildDir, "temp/variant-merge/")
        tempDir.deleteDir()
        tempDir.mkdirs()
        
        // Ëß£ÂéãÂéüÂßã AAR
        project.copy {
            from project.zipTree(originalAar)
            into tempDir
        }
        println "  ‚úÖ Ëß£ÂéãÂéüÂßã AAR"
        
        // ÂàõÂª∫ÂêàÂπ∂ÁöÑ classes ÁõÆÂΩï
        def mergedClassesDir = new File(tempDir, "merged-classes/")
        mergedClassesDir.mkdirs()
        
        // ÂÖàÂ§çÂà∂ÂéüÂßãÁöÑ classes.jar ÂÜÖÂÆπ
        def originalClassesJar = new File(tempDir, "classes.jar")
        if (originalClassesJar.exists()) {
            project.copy {
                from project.zipTree(originalClassesJar)
                include '**/*.class'
                into mergedClassesDir
                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
            }
            println "  ‚úÖ ÊèêÂèñÂéüÂßã classes.jar"
        }
        
        // Êî∂ÈõÜÊâÄÊúâ‰æùËµñÁöÑÁ±ªÊñá‰ª∂
        def dependencyCount = 0
        def depFiles = dependencyFiles.files
        
        println "\nüìö ÂºÄÂßãÂêàÂπ∂‰æùËµñ (ÂÖ± ${depFiles.size()} ‰∏™Êñá‰ª∂)..."
        
        depFiles.each { file ->
            if (file.exists()) {
                dependencyCount++
                
                if (file.name.endsWith('.jar')) {
                    // ÂêàÂπ∂ JAR Êñá‰ª∂
                    try {
                        project.copy {
                            from project.zipTree(file)
                            include '**/*.class'
                            exclude 'META-INF/**'
                            exclude 'module-info.class'
                            into mergedClassesDir
                            duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                        }
                        println "  ‚úÖ ÂêàÂπ∂ JAR: ${file.name}"
                    } catch (Exception e) {
                        println "  ‚ö†Ô∏è  Ë∑≥Ëøá JAR: ${file.name} - ${e.message}"
                    }
                    
                } else if (file.name.endsWith('.aar')) {
                    // ÂêàÂπ∂ AAR ‰∏≠ÁöÑ classes.jar ÂíåËµÑÊ∫ê
                    try {
                        def tempAarDir = new File(tempDir, "temp-aar-${file.name.replace('.aar', '')}/")
                        tempAarDir.mkdirs()
                        
                        // Ëß£ÂéãÊï¥‰∏™ AAR
                        project.copy {
                            from project.zipTree(file)
                            into tempAarDir
                        }
                        
                        // 1. ÂêàÂπ∂ classes.jar
                        def classesJar = new File(tempAarDir, "classes.jar")
                        if (classesJar.exists()) {
                            project.copy {
                                from project.zipTree(classesJar)
                                include '**/*.class'
                                exclude 'META-INF/**'
                                exclude 'module-info.class'
                                into mergedClassesDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 2. ÂêàÂπ∂ËµÑÊ∫êÊñá‰ª∂ (res ÁõÆÂΩï)
                        def resDir = new File(tempAarDir, "res")
                        if (resDir.exists() && resDir.isDirectory()) {
                            def targetResDir = new File(tempDir, "res")
                            targetResDir.mkdirs()
                            
                            def resFileCount = 0
                            resDir.eachFileRecurse { resFile ->
                                if (resFile.isFile()) {
                                    resFileCount++
                                }
                            }
                            
                            println "    üìÅ ÂèëÁé∞ ${resFileCount} ‰∏™ËµÑÊ∫êÊñá‰ª∂"
                            
                            // ÂàÜÂà´Â§ÑÁêÜ values ÁõÆÂΩïÂíåÂÖ∂‰ªñËµÑÊ∫êÁõÆÂΩï
                            resDir.listFiles()?.each { subDir ->
                                if (subDir.isDirectory()) {
                                    def targetSubDir = new File(targetResDir, subDir.name)
                                    targetSubDir.mkdirs()
                                    
                                    if (subDir.name.startsWith('values')) {
                                        // ‚úÖ values ÁõÆÂΩïÈúÄË¶ÅÂêàÂπ∂ XML ÂÜÖÂÆπ
                                        println "    üîÄ ÂêàÂπ∂ values ËµÑÊ∫ê: ${subDir.name}"
                                        subDir.listFiles()?.each { xmlFile ->
                                            if (xmlFile.name.endsWith('.xml')) {
                                                def targetXmlFile = new File(targetSubDir, xmlFile.name)
                                                if (targetXmlFile.exists()) {
                                                    // ÂêàÂπ∂ XML ÂÜÖÂÆπ
                                                    try {
                                                        def sourceXml = new XmlParser().parse(xmlFile)
                                                        def targetXml = new XmlParser().parse(targetXmlFile)
                                                        
                                                        // Êî∂ÈõÜÂ∑≤Â≠òÂú®ÁöÑËµÑÊ∫êÂêçÁß∞
                                                        def existingNames = [] as Set
                                                        targetXml.children().each { node ->
                                                            if (node instanceof groovy.util.Node) {
                                                                def name = node.attribute('name')
                                                                if (name) {
                                                                    existingNames.add(name)
                                                                }
                                                            }
                                                        }
                                                        
                                                        // Ê∑ªÂä†Êñ∞ËµÑÊ∫ê
                                                        def addedCount = 0
                                                        sourceXml.children().each { node ->
                                                            if (node instanceof groovy.util.Node) {
                                                                def name = node.attribute('name')
                                                                if (name && !existingNames.contains(name)) {
                                                                    targetXml.append(node)
                                                                    addedCount++
                                                                }
                                                            }
                                                        }
                                                        
                                                        if (addedCount > 0) {
                                                            // ÂÜôÂõûÊñá‰ª∂
                                                            def writer = new FileWriter(targetXmlFile)
                                                            def printer = new XmlNodePrinter(new PrintWriter(writer))
                                                            printer.preserveWhitespace = true
                                                            printer.print(targetXml)
                                                            writer.close()
                                                            println "      ‚úÖ ${xmlFile.name}: Ê∑ªÂä† ${addedCount} ‰∏™ËµÑÊ∫ê"
                                                        }
                                                    } catch (Exception e) {
                                                        println "      ‚ö†Ô∏è  ÂêàÂπ∂ ${xmlFile.name} Â§±Ë¥•: ${e.message}"
                                                        // Â§±Ë¥•Êó∂Ë∑≥ËøáÔºå‰øùÁïôÂéüÊúâÊñá‰ª∂
                                                    }
                                                } else {
                                                    // Êñá‰ª∂‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•Â§çÂà∂
                                                    project.copy {
                                                        from xmlFile
                                                        into targetSubDir
                                                    }
                                                }
                                            }
                                        }
                                    } else {
                                        // ÂÖ∂‰ªñËµÑÊ∫êÁõÆÂΩïÔºàdrawable, layout Á≠âÔºâÁõ¥Êé•Â§çÂà∂
                                        project.copy {
                                            from subDir
                                            into targetSubDir
                                            duplicatesStrategy = DuplicatesStrategy.WARN
                                        }
                                    }
                                }
                            }
                            
                            println "    ‚úÖ ËµÑÊ∫êÊñá‰ª∂Â∑≤ÂêàÂπ∂"
                        } else {
                            println "    ‚ö†Ô∏è  Ê≤°Êúâ res ÁõÆÂΩï"
                        }
                        
                        // 3. ÂêàÂπ∂ R.txt (ËµÑÊ∫ê ID Êñá‰ª∂)
                        def rTxt = new File(tempAarDir, "R.txt")
                        if (rTxt.exists()) {
                            def targetRTxt = new File(tempDir, "R.txt")
                            if (targetRTxt.exists()) {
                                // ËøΩÂä†ÂÜÖÂÆπÔºåÈÅøÂÖçË¶ÜÁõñ
                                targetRTxt.append(rTxt.text)
                            } else {
                                project.copy {
                                    from rTxt
                                    into tempDir
                                }
                            }
                        }
                        
                        // 4. ÂêàÂπ∂ assets ÁõÆÂΩï
                        def assetsDir = new File(tempAarDir, "assets")
                        if (assetsDir.exists() && assetsDir.isDirectory()) {
                            def targetAssetsDir = new File(tempDir, "assets")
                            targetAssetsDir.mkdirs()
                            
                            project.copy {
                                from assetsDir
                                into targetAssetsDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 5. ÂêàÂπ∂ jni ÁõÆÂΩï (native libraries)
                        def jniDir = new File(tempAarDir, "jni")
                        if (jniDir.exists() && jniDir.isDirectory()) {
                            def targetJniDir = new File(tempDir, "jni")
                            targetJniDir.mkdirs()
                            
                            project.copy {
                                from jniDir
                                into targetJniDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 6. ÂêàÂπ∂ libs ÁõÆÂΩï (È¢ùÂ§ñÁöÑ JAR ‰æùËµñ)
                        def libsDir = new File(tempAarDir, "libs")
                        if (libsDir.exists() && libsDir.isDirectory()) {
                            def targetLibsDir = new File(tempDir, "libs")
                            targetLibsDir.mkdirs()
                            
                            project.copy {
                                from libsDir
                                into targetLibsDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 7. ÂêàÂπ∂ proguard.txt (ProGuard ËßÑÂàô)
                        def proguardTxt = new File(tempAarDir, "proguard.txt")
                        if (proguardTxt.exists()) {
                            def targetProguardTxt = new File(tempDir, "proguard.txt")
                            if (targetProguardTxt.exists()) {
                                // ËøΩÂä†ÂÜÖÂÆπÔºåÈÅøÂÖçË¶ÜÁõñ
                                targetProguardTxt.append("\n# From ${file.name}\n")
                                targetProguardTxt.append(proguardTxt.text)
                            } else {
                                project.copy {
                                    from proguardTxt
                                    into tempDir
                                }
                            }
                        }
                        
                        // 8. ÂêàÂπ∂ consumer-proguard-rules.pro (Ê∂àË¥πËÄÖ ProGuard ËßÑÂàô)
                        def consumerProguard = new File(tempAarDir, "consumer-proguard-rules.pro")
                        if (consumerProguard.exists()) {
                            def targetConsumerProguard = new File(tempDir, "consumer-proguard-rules.pro")
                            if (targetConsumerProguard.exists()) {
                                // ËøΩÂä†ÂÜÖÂÆπÔºåÈÅøÂÖçË¶ÜÁõñ
                                targetConsumerProguard.append("\n# From ${file.name}\n")
                                targetConsumerProguard.append(consumerProguard.text)
                            } else {
                                project.copy {
                                    from consumerProguard
                                    into tempDir
                                }
                            }
                        }
                        
                        // 9. ÂêàÂπ∂ public.txt (ÂÖ¨ÂÖ±ËµÑÊ∫êÂàóË°®)
                        def publicTxt = new File(tempAarDir, "public.txt")
                        if (publicTxt.exists()) {
                            def targetPublicTxt = new File(tempDir, "public.txt")
                            if (targetPublicTxt.exists()) {
                                // ËøΩÂä†ÂÜÖÂÆπÔºåÈÅøÂÖçË¶ÜÁõñ
                                targetPublicTxt.append(publicTxt.text)
                            } else {
                                project.copy {
                                    from publicTxt
                                    into tempDir
                                }
                            }
                        }
                        
                        // 10. ÂêàÂπ∂ aidl ÁõÆÂΩï (AIDL Êé•Âè£Êñá‰ª∂)
                        def aidlDir = new File(tempAarDir, "aidl")
                        if (aidlDir.exists() && aidlDir.isDirectory()) {
                            def targetAidlDir = new File(tempDir, "aidl")
                            targetAidlDir.mkdirs()
                            
                            project.copy {
                                from aidlDir
                                into targetAidlDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 11. ÂêàÂπ∂ annotations.zip (Ê≥®Ëß£Êñá‰ª∂)
                        def annotationsZip = new File(tempAarDir, "annotations.zip")
                        if (annotationsZip.exists()) {
                            def targetAnnotationsZip = new File(tempDir, "annotations.zip")
                            if (!targetAnnotationsZip.exists()) {
                                project.copy {
                                    from annotationsZip
                                    into tempDir
                                }
                            }
                        }
                        
                        // 12. ÂêàÂπ∂ prefab ÁõÆÂΩï (C/C++ Â∫ìÈÖçÁΩÆ)
                        def prefabDir = new File(tempAarDir, "prefab")
                        if (prefabDir.exists() && prefabDir.isDirectory()) {
                            def targetPrefabDir = new File(tempDir, "prefab")
                            targetPrefabDir.mkdirs()
                            
                            project.copy {
                                from prefabDir
                                into targetPrefabDir
                                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
                            }
                        }
                        
                        // 13. ÂêàÂπ∂ navigation.json (Navigation ÁªÑ‰ª∂ÈÖçÁΩÆ)
                        def navigationJson = new File(tempAarDir, "navigation.json")
                        if (navigationJson.exists()) {
                            def targetNavigationJson = new File(tempDir, "navigation.json")
                            if (!targetNavigationJson.exists()) {
                                project.copy {
                                    from navigationJson
                                    into tempDir
                                }
                            }
                        }
                        
                        println "  ‚úÖ ÂêàÂπ∂ AAR: ${file.name}"
                        
                        tempAarDir.deleteDir()
                    } catch (Exception e) {
                        println "  ‚ö†Ô∏è  Ë∑≥Ëøá AAR: ${file.name} - ${e.message}"
                    }
                }
            }
        }
        
        println "\nüìä ÂÖ±Â§ÑÁêÜ ${dependencyCount} ‰∏™‰æùËµñÊñá‰ª∂"
        
        // ‚úÖ ÈáçË¶ÅÔºöÊúÄÂêéÂÜçÊ¨°Â§çÂà∂ omm-lib Ëá™Â∑±ÁöÑËµÑÊ∫êÔºåÁ°Æ‰øù‰ºòÂÖàÁ∫ßÊúÄÈ´ò
        println "\nüîù Á°Æ‰øù omm-lib Ëá™Ë∫´ËµÑÊ∫ê‰ºòÂÖàÁ∫ßÊúÄÈ´ò..."
        
        // Ëß£Âéã omm-lib ÁöÑ AAR Âà∞‰∏¥Êó∂ÁõÆÂΩï
        def ommResTemp = new File(tempDir, "omm-res-temp")
        ommResTemp.mkdirs()
        project.copy {
            from project.zipTree(originalAar)
            include 'res/**'
            into ommResTemp
        }
        
        def ommResDir = new File(ommResTemp, "res")
        if (ommResDir.exists()) {
            def targetResDir = new File(tempDir, "res")
            
            ommResDir.listFiles()?.each { subDir ->
                if (subDir.isDirectory()) {
                    def targetSubDir = new File(targetResDir, subDir.name)
                    targetSubDir.mkdirs()
                    
                    if (subDir.name.startsWith('values')) {
                        // values ÁõÆÂΩïÔºöÂêàÂπ∂ XML ÂÜÖÂÆπÔºåomm-lib ÁöÑËµÑÊ∫ê‰ºòÂÖà
                        println "  üîÄ ÂêàÂπ∂ omm-lib ÁöÑ values ËµÑÊ∫ê: ${subDir.name}"
                        subDir.listFiles()?.each { xmlFile ->
                            if (xmlFile.name.endsWith('.xml')) {
                                def targetXmlFile = new File(targetSubDir, xmlFile.name)
                                if (targetXmlFile.exists()) {
                                    try {
                                        def sourceXml = new XmlParser().parse(xmlFile)
                                        def targetXml = new XmlParser().parse(targetXmlFile)
                                        
                                        // Êî∂ÈõÜÁõÆÊ†áÊñá‰ª∂‰∏≠ÁöÑËµÑÊ∫êÂêçÁß∞
                                        def targetNames = [:] // name -> node
                                        targetXml.children().each { node ->
                                            if (node instanceof groovy.util.Node) {
                                                def name = node.attribute('name')
                                                if (name) {
                                                    targetNames[name] = node
                                                }
                                            }
                                        }
                                        
                                        // Áî® omm-lib ÁöÑËµÑÊ∫êÊõøÊç¢ÂêåÂêçËµÑÊ∫ê
                                        def replacedCount = 0
                                        def addedCount = 0
                                        sourceXml.children().each { sourceNode ->
                                            if (sourceNode instanceof groovy.util.Node) {
                                                def name = sourceNode.attribute('name')
                                                if (name) {
                                                    if (targetNames.containsKey(name)) {
                                                        // ÊõøÊç¢Â∑≤Â≠òÂú®ÁöÑËµÑÊ∫ê
                                                        def targetNode = targetNames[name]
                                                        def parent = targetNode.parent()
                                                        def index = parent.children().indexOf(targetNode)
                                                        parent.remove(targetNode)
                                                        parent.children().add(index, sourceNode)
                                                        replacedCount++
                                                    } else {
                                                        // Ê∑ªÂä†Êñ∞ËµÑÊ∫ê
                                                        targetXml.append(sourceNode)
                                                        addedCount++
                                                    }
                                                }
                                            }
                                        }
                                        
                                        // ÂÜôÂõûÊñá‰ª∂
                                        def writer = new FileWriter(targetXmlFile)
                                        def printer = new XmlNodePrinter(new PrintWriter(writer))
                                        printer.preserveWhitespace = true
                                        printer.print(targetXml)
                                        writer.close()
                                        
                                        if (replacedCount > 0 || addedCount > 0) {
                                            println "    ‚úÖ ${xmlFile.name}: ÊõøÊç¢ ${replacedCount} ‰∏™, Ê∑ªÂä† ${addedCount} ‰∏™"
                                        }
                                    } catch (Exception e) {
                                        println "    ‚ö†Ô∏è  ÂêàÂπ∂ ${xmlFile.name} Â§±Ë¥•: ${e.message}"
                                    }
                                } else {
                                    // Êñá‰ª∂‰∏çÂ≠òÂú®ÔºåÁõ¥Êé•Â§çÂà∂
                                    project.copy {
                                        from xmlFile
                                        into targetSubDir
                                    }
                                }
                            }
                        }
                    } else {
                        // ÂÖ∂‰ªñËµÑÊ∫êÁõÆÂΩïÔºöÁõ¥Êé•Ë¶ÜÁõñ
                        project.copy {
                            from subDir
                            into targetSubDir
                            duplicatesStrategy = DuplicatesStrategy.INCLUDE
                        }
                    }
                }
            }
        }
        
        // Ê∏ÖÁêÜ‰∏¥Êó∂ÁõÆÂΩï
        ommResTemp.deleteDir()
        println "  ‚úÖ omm-lib ËµÑÊ∫êÂ∑≤Á°Æ‰øù‰ºòÂÖà"
        
        // ÂàõÂª∫Êñ∞ÁöÑ classes.jar
        if (mergedClassesDir.listFiles()?.size() > 0) {
            println "üì¶ ÂàõÂª∫ÂêàÂπ∂ÁöÑ classes.jar..."
            
            def mergedJarFile = new File(tempDir, "classes-merged.jar")
            def jarOutput = new JarOutputStream(new FileOutputStream(mergedJarFile))
            
            // Êî∂ÈõÜÊâÄÊúâ class Êñá‰ª∂
            def classFiles = []
            mergedClassesDir.eachFileRecurse { file ->
                if (file.isFile() && file.name.endsWith('.class')) {
                    classFiles << file
                }
            }
            
            // ÂÜôÂÖ• JAR
            classFiles.each { file ->
                def entryName = mergedClassesDir.toURI().relativize(file.toURI()).toString()
                jarOutput.putNextEntry(new ZipEntry(entryName))
                jarOutput.write(file.bytes)
                jarOutput.closeEntry()
            }
            jarOutput.close()
            
            // ÊõøÊç¢ÂéüÂßãÁöÑ classes.jar
            if (originalClassesJar.exists()) {
                originalClassesJar.delete()
            }
            mergedJarFile.renameTo(originalClassesJar)
            
            println "‚úÖ Á±ªÊñá‰ª∂ÂêàÂπ∂ÂÆåÊàê (${classFiles.size()} ‰∏™Á±ª)"
        }
        
        // Ê∏ÖÁêÜ‰∏¥Êó∂ÁõÆÂΩï
        mergedClassesDir.deleteDir()
        new File(tempDir, "temp-aar/").deleteDir()
        
        // ÈáçÊñ∞ÊâìÂåÖ‰∏∫ AAR
        def outputFile = outputAar.get().asFile
        outputFile.parentFile.mkdirs()
        
        project.ant.zip(destfile: outputFile) {
            fileset(dir: tempDir) {
                include(name: "**/*")
                exclude(name: "merged-classes/**")
                exclude(name: "temp-aar*/**")
            }
        }
        
        println """
üéâ [Variant API] ‰∏ÄÁ´ôÂºèÊâìÂåÖÂÆåÊàêÔºÅ
üìä ÁªüËÆ°‰ø°ÊÅØ:
  - ÂéüÂßã AAR: ${String.format("%.2f", originalAar.size() / 1024 / 1024)} MB
  - ÂêàÂπ∂Âêé AAR: ${String.format("%.2f", outputFile.size() / 1024 / 1024)} MB
  - Â§ÑÁêÜ‰æùËµñÊï∞: ${dependencyCount}
üìç ËæìÂá∫Êñá‰ª∂: ${outputFile.path}
        """
        
        // Ê∏ÖÁêÜ‰∏¥Êó∂ÁõÆÂΩï
        tempDir.deleteDir()
    }
}

// ‰ΩøÁî® Variant API Ê≥®ÂÜå‰ªªÂä°
androidComponents {
    onVariants(selector().withBuildType("release")) { variant ->
        
        println "üîß [ÈÖçÁΩÆÈò∂ÊÆµ] Ê≠£Âú®‰∏∫ ${variant.name} Âèò‰ΩìÈÖçÁΩÆÂêàÂπ∂‰ªªÂä°..."
        
        // Ê≥®ÂÜåÂêàÂπ∂‰æùËµñ‰ªªÂä°
        def mergeTask = project.tasks.register(
            "merge${variant.name.capitalize()}Dependencies",
            MergeAllDependenciesTask.class
        ) { task ->
            // ËæìÂÖ•ÔºöÂéüÂßã AAR ÁõÆÂΩï
            task.aarDirectory.set(
                project.layout.buildDirectory.dir("outputs/aar")
            )
            
            // ‰æùËµñ bundleReleaseAar ‰ªªÂä°
            task.dependsOn("bundle${variant.name.capitalize()}Aar")
            
            // Á°Æ‰øùÊâÄÊúâÈ°πÁõÆ‰æùËµñÁöÑ AAR ÈÉΩÂ∑≤ÊûÑÂª∫
            def projectDeps = []
            project.configurations.implementation.allDependencies.each { dep ->
                if (dep instanceof ProjectDependency) {
                    def depProject = dep.dependencyProject
                    projectDeps << depProject.name
                    
                    // ‰æùËµñÊØè‰∏™È°πÁõÆÁöÑ bundle ‰ªªÂä°
                    def bundleTaskName = "bundle${variant.name.capitalize()}Aar"
                    try {
                        def depBundleTask = depProject.tasks.findByName(bundleTaskName)
                        if (depBundleTask) {
                            task.dependsOn(depBundleTask)
                            println "  ‚úÖ Ê∑ªÂä†‰æùËµñ: ${depProject.name}:${bundleTaskName}"
                        }
                    } catch (Exception e) {
                        println "  ‚ö†Ô∏è  ÈÖçÁΩÆ‰æùËµñÂ§±Ë¥•: ${depProject.name} - ${e.message}"
                    }
                }
            }
            
            println "üì¶ È°πÁõÆ‰æùËµñÊÄªÊï∞: ${projectDeps.size()}"
            
            // ËæìÂÖ•Ôºö‰æùËµñÊñá‰ª∂ÈõÜÂêà - Âú®ÊâßË°åÈò∂ÊÆµÂä®ÊÄÅÊî∂ÈõÜ
            task.dependencyFiles.from(
                project.provider {
                    println "\nüîç [ÊâßË°åÈò∂ÊÆµ] ÂºÄÂßãÊî∂ÈõÜ‰æùËµñÊñá‰ª∂..."
                    def files = []
                    def projectAars = []
                    def externalJars = []
                    def externalAars = []
                    
                    // 1. Êî∂ÈõÜÈ°πÁõÆ‰æùËµñÁöÑ AAR
                    println "üì¶ Êî∂ÈõÜÈ°πÁõÆ‰æùËµñÁöÑ AAR..."
                    project.configurations.implementation.allDependencies.each { dep ->
                        if (dep instanceof ProjectDependency) {
                            def depProject = dep.dependencyProject
                            def aarDir = new File(depProject.buildDir, "outputs/aar")
                            
                            if (aarDir.exists()) {
                                def found = false
                                aarDir.listFiles()?.each { file ->
                                    if (file.name.endsWith('.aar') && file.name.contains('release')) {
                                        files << file
                                        projectAars << file.name
                                        found = true
                                        println "  ‚úÖ ${depProject.name}: ${file.name} (${String.format("%.2f", file.size() / 1024 / 1024)} MB)"
                                    }
                                }
                                if (!found) {
                                    println "  ‚ö†Ô∏è  ${depProject.name}: Êú™ÊâæÂà∞ release AAR"
                                }
                            } else {
                                println "  ‚ùå ${depProject.name}: AAR ÁõÆÂΩï‰∏çÂ≠òÂú®"
                            }
                        }
                    }
                    
                    // 2. Êî∂ÈõÜÂ§ñÈÉ®‰æùËµñÂíåÊñá‰ª∂‰æùËµñ
                    println "\nüìö Êî∂ÈõÜÂ§ñÈÉ®‰æùËµñ..."
                    // ‚ö†Ô∏è ÊöÇÊó∂Ë∑≥ËøáÂ§ñÈÉ®‰æùËµñÊî∂ÈõÜÔºåÈÅøÂÖçÈÖçÁΩÆÈò∂ÊÆµËß£Êûê‰æùËµñÂØºËá¥ÁöÑÈóÆÈ¢ò
                    // Â§ñÈÉ®‰æùËµñÔºàÂ¶Ç AndroidXÔºâÁ¨¨‰∏âÊñπÈ°πÁõÆ‰πü‰ºöÊúâÔºå‰∏çÈúÄË¶ÅÂêàÂπ∂
                    println "  ‚ö†Ô∏è  Ë∑≥ËøáÂ§ñÈÉ®‰æùËµñÊî∂ÈõÜÔºàÈÅøÂÖçÈÖçÁΩÆÈò∂ÊÆµËß£ÊûêÈóÆÈ¢òÔºâ"
                    
                    /*
                    try {
                        // ‰ΩøÁî® runtimeClasspath ÈÖçÁΩÆÊù•Ëß£Êûê‰æùËµñ
                        def runtimeConfig = project.configurations.findByName('releaseRuntimeClasspath')
                        if (!runtimeConfig) {
                            runtimeConfig = project.configurations.findByName('runtimeClasspath')
                        }
                        
                        if (runtimeConfig) {
                            def resolvedArtifacts = runtimeConfig.resolvedConfiguration.resolvedArtifacts
                            println "  Ëß£ÊûêÂà∞ ${resolvedArtifacts.size()} ‰∏™‰æùËµñ"
                            
                            resolvedArtifacts.each { artifact ->
                                def file = artifact.file
                                
                                if (file.exists()) {
                                    def isProjectAar = projectAars.any { it == file.name }
                                    
                                    if (!isProjectAar) {
                                        if (file.name.endsWith('.jar')) {
                                            files << file
                                            externalJars << file.name
                                            println "  ‚úÖ JAR: ${file.name}"
                                        } else if (file.name.endsWith('.aar')) {
                                            files << file
                                            externalAars << file.name
                                            println "  ‚úÖ AAR: ${file.name}"
                                        }
                                    }
                                }
                            }
                        } else {
                            println "  ‚ö†Ô∏è  Êú™ÊâæÂà∞ÂèØËß£ÊûêÁöÑ runtime ÈÖçÁΩÆ"
                        }
                    } catch (Exception e) {
                        println "  ‚ùå Ëß£ÊûêÂ§ñÈÉ®‰æùËµñÊó∂Âá∫Èîô: ${e.message}"
                        e.printStackTrace()
                    }
                    */
                    
                    println "\nüìä ‰æùËµñÊî∂ÈõÜÁªüËÆ°:"
                    println "  - È°πÁõÆ AAR: ${projectAars.size()}"
                    println "  - Â§ñÈÉ® AAR: ${externalAars.size()}"
                    println "  - Â§ñÈÉ® JAR: ${externalJars.size()}"
                    println "  - ÊÄªËÆ°: ${files.size()} ‰∏™Êñá‰ª∂"
                    
                    if (files.isEmpty()) {
                        println "\n‚ö†Ô∏è  Ë≠¶Âëä: Êú™Êî∂ÈõÜÂà∞‰ªª‰Ωï‰æùËµñÊñá‰ª∂ÔºÅ"
                    }
                    
                    return files
                }
            )
            
            // ËæìÂá∫ÔºöÂêàÂπ∂ÂêéÁöÑ AAR
            task.outputAar.set(
                new File(project.buildDir, "outputs/aar/${variant.name}-complete.aar")
            )
            
            task.group = 'build'
            task.description = "ÂêàÂπ∂ ${variant.name} ÁöÑÊâÄÊúâ‰æùËµñÂà∞Âçï‰∏™ AAR"
        }
        
        println "‚úÖ Â∑≤Ê≥®ÂÜå‰ªªÂä°: merge${variant.name.capitalize()}Dependencies"
    }
}

// ‰∏ÄÈîÆÊûÑÂª∫‰ªªÂä°
task buildCompleteAar {
    group = 'build'
    description = 'ÊûÑÂª∫ÂåÖÂê´ÊâÄÊúâ‰æùËµñÁöÑÂÆåÊï¥ AAR'
    
    dependsOn 'clean', 'mergeReleaseDependencies'
    
    doLast {
        println """
üéâ ÂÆåÊï¥ AAR ÊûÑÂª∫ÂÆåÊàêÔºÅ
üìç ËæìÂá∫Êñá‰ª∂: build/outputs/aar/release-complete.aar

Á¨¨‰∏âÊñπ‰ΩøÁî®ÊñπÊ≥ï:
1. Â∞Ü release-complete.aar ÈáçÂëΩÂêç‰∏∫ omm-sdk-complete.aar
2. Â§çÂà∂Âà∞Á¨¨‰∏âÊñπÈ°πÁõÆÁöÑ libs ÁõÆÂΩï
3. Âú® build.gradle ‰∏≠Ê∑ªÂä†:
   implementation(name: 'omm-sdk-complete', ext: 'aar')
        """
    }
}

// Á°Æ‰øù‰ªªÂä°ÊâßË°åÈ°∫Â∫è
afterEvaluate {
    def mergeTask = tasks.findByName('mergeReleaseDependencies')
    if (mergeTask) {
        mergeTask.mustRunAfter 'clean'
    }
}
